<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>科目三灯光考试模拟</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --panel: rgba(15, 23, 42, 0.75);
      --text: #e2e8f0;
      --green: #16a34a;
      --red: #f43f5e;
      --gray: #94a3b8;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", sans-serif;
      background: radial-gradient(circle at top, #1f2937, #020617 65%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 20px 10px 60px;
    }
    #app {
      width: min(900px, 100%);
    }
    .exam-box {
      background: var(--panel);
      border: 1px solid rgba(148, 163, 184, 0.12);
      border-radius: 20px;
      padding: 16px 16px 26px;
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 40px rgba(0,0,0,0.35);
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .title {
      font-size: 1.1rem;
      margin: 0;
    }
    .timer {
      font-weight: 600;
      color: #f97316;
    }
    .question {
      font-size: 1.02rem;
      line-height: 1.6;
      margin-bottom: 1rem;
      white-space: pre-line;
    }
    .options {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }
    .option-btn {
      background: rgba(15,23,42,0.1);
      border: 1px solid rgba(148, 163, 184, 0.28);
      border-radius: 14px;
      padding: 0.55rem 0.9rem;
      text-align: left;
      font-size: 0.96rem;
      color: inherit;
      cursor: pointer;
      transition: 0.12s ease-out;
    }
    .option-btn:hover {
      background: rgba(148, 163, 184, 0.04);
    }
    .option-btn.disabled {
      pointer-events: none;
      opacity: 0.7;
    }
    .option-btn.correct {
      background: rgba(22, 163, 74, 0.18);
      border-color: rgba(22, 163, 74, 0.65);
    }
    .option-btn.wrong {
      background: rgba(244, 63, 94, 0.18);
      border-color: rgba(244, 63, 94, 0.6);
    }
    .result {
      margin-top: 1rem;
      min-height: 1.3rem;
      font-weight: 600;
    }
    .result.ok { color: var(--green); }
    .result.bad { color: var(--red); }
    .footer-tip {
      margin-top: 1.1rem;
      font-size: 0.8rem;
      color: var(--gray);
    }
    .score-panel {
      text-align: center;
      padding: 2.5rem 1rem 2rem;
    }
    .score-big {
      font-size: 3.4rem;
      font-weight: 800;
      margin-bottom: 1rem;
    }
    .btn {
      background: #3b82f6;
      border: none;
      border-radius: 9999px;
      color: #fff;
      padding: 0.45rem 1.2rem;
      cursor: pointer;
      font-weight: 500;
    }
    @media (max-width: 640px) {
      .exam-box { border-radius: 14px; }
      .header { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // 固定选项
    const ALL_OPTIONS = [
      "① 开远光灯",
      "② 开近光灯",
      "③ 先打左转向灯，再远近光灯交替；超车完成回原车道后，先打右转向灯",
      "④ 开示廓灯和危险报警闪光灯",
      "⑤ 远近光灯交替两次",
      "⑥ 开前照灯、前后雾灯、危险报警闪光灯",
      "⑦ 关大灯，开示廓灯、危险报警闪光灯"
    ];

    // 题库
    const QUESTION_BANK = [
      { id: 2,  text: "夜间在没有路灯、照明不良条件下行驶", answer_index: 0 },
      { id: 3,  text: "夜间在没有路灯、照明不良条件下的市区行驶", answer_index: 1 },
      { id: 4,  text: "夜间超车，应如何正确使用灯光？", answer_index: 2 },
      { id: 5,  text: "路边临时停车", answer_index: 3 },
      { id: 6,  text: "夜间同方向近距离跟车行驶", answer_index: 1 },
      { id: 7,  text: "夜间通过急弯、坡路、拱桥、人行横道时", answer_index: 4 },
      { id: 8,  text: "雾天行驶", answer_index: 5 },
      { id: 9,  text: "夜间在窄路或窄桥与非机动车会车时", answer_index: 1 },
      { id:10,  text: "夜间遇对方向车，距对方来车将近150米时", answer_index: 1 },
      { id:11,  text: "夜间在道路上发生故障，妨碍交通又难以移动时", answer_index: 6 },
      { id:12,  text: "夜间通过没有交通信号灯的路口时", answer_index: 4 },
    ];

    // 全局状态
    let currentQuestions = [];
    let currentIndex = -1;
    let score = 0;
    let wrongQuestions = [];
    let timeLeft = 5;
    let timer = null;
    let examRunning = false;

    // 渲染一个考试框架
    function renderExamFrame(titleText = "科目三灯光考试模拟") {
      const app = document.getElementById("app");
      app.innerHTML = `
        <div class="exam-box">
          <div class="header">
            <h1 class="title" id="title">${titleText}</h1>
            <div class="timer" id="timer">剩余时间：5 秒</div>
          </div>
          <div class="question" id="question">正在载入题目...</div>
          <div class="options" id="options"></div>
          <div class="result" id="result"></div>
          <div class="footer-tip" id="footer-tip">
            规则：随机抽取 5 题，每题 5 秒，答错扣 1 分；全部做完显示成绩；如有错题，5 秒后自动开始“错题再考”。
          </div>
        </div>
      `;
    }

    // 随机打乱
    function shuffle(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    // 开始一轮考试
    function startExam(questions = null) {
      if (questions === null) {
        currentQuestions = shuffle(QUESTION_BANK).slice(0, 5);
        renderExamFrame("科目三灯光考试模拟");
      } else {
        // 错题再考
        currentQuestions = questions.length > 5 ? shuffle(questions).slice(0, 5) : questions.slice();
        renderExamFrame("科目三灯光考试模拟（错题再考）");
      }
      currentIndex = -1;
      score = 0;
      wrongQuestions = [];
      examRunning = true;
      showNextQuestion();
    }

    function showNextQuestion() {
      if (timer) clearTimeout(timer);

      currentIndex++;
      if (currentIndex >= currentQuestions.length) {
        finishExam();
        return;
      }

      const q = currentQuestions[currentIndex];
      const qEl = document.getElementById("question");
      const optEl = document.getElementById("options");
      const resEl = document.getElementById("result");

      qEl.textContent = `第 ${currentIndex + 1} 题 / 共 ${currentQuestions.length} 题\n${q.text}`;
      resEl.textContent = "";
      optEl.innerHTML = "";

      ALL_OPTIONS.forEach((text, idx) => {
        const btn = document.createElement("button");
        btn.className = "option-btn";
        btn.textContent = text;
        btn.addEventListener("click", () => onOptionClick(idx));
        optEl.appendChild(btn);
      });

      timeLeft = 5;
      examRunning = true;
      updateTimer();
    }

    function updateTimer() {
      const tEl = document.getElementById("timer");
      tEl.textContent = `剩余时间：${timeLeft} 秒`;
      if (timeLeft <= 0) {
        onTimeout();
      } else {
        timeLeft--;
        timer = setTimeout(updateTimer, 1000);
      }
    }

    function onOptionClick(idx) {
      if (!examRunning) return;
      if (currentIndex < 0 || currentIndex >= currentQuestions.length) return;

      examRunning = false;
      if (timer) clearTimeout(timer);

      const q = currentQuestions[currentIndex];
      const correctIdx = q.answer_index;
      const optEl = document.getElementById("options");
      const resEl = document.getElementById("result");
      const btns = optEl.querySelectorAll(".option-btn");

      if (idx === correctIdx) {
        score += 1;
        resEl.textContent = "✅ 正确";
        resEl.className = "result ok";
        btns[idx].classList.add("correct");
      } else {
        resEl.textContent = "❌ 错误";
        resEl.className = "result bad";
        btns[idx].classList.add("wrong");
        btns[correctIdx].classList.add("correct");
        wrongQuestions.push(q);
      }

      btns.forEach(b => b.classList.add("disabled"));
      setTimeout(showNextQuestion, 1200);
    }

    function onTimeout() {
      if (currentIndex < 0 || currentIndex >= currentQuestions.length) return;

      examRunning = false;
      const q = currentQuestions[currentIndex];
      const correctIdx = q.answer_index;
      const optEl = document.getElementById("options");
      const resEl = document.getElementById("result");
      const btns = optEl.querySelectorAll(".option-btn");

      resEl.textContent = "⌛ 超时，算错误";
      resEl.className = "result bad";
      btns[correctIdx].classList.add("correct");
      btns.forEach(b => b.classList.add("disabled"));
      wrongQuestions.push(q);

      setTimeout(showNextQuestion, 1200);
    }

    function finishExam() {
      if (timer) clearTimeout(timer);
      examRunning = false;

      const app = document.getElementById("app");
      const total = currentQuestions.length;
      app.innerHTML = `
        <div class="exam-box">
          <div class="score-panel">
            <div class="score-big">${score} / ${total}</div>
            <p>本轮考试结束！</p>
            ${
              wrongQuestions.length
                ? `<p>你有 <strong>${wrongQuestions.length}</strong> 道题答错，<strong>5 秒后</strong>将自动开始错题再考。</p>`
                : `<p>全部答对，恭喜！</p>`
            }
            <p style="margin-top:1.3rem;">
              <button class="btn" id="again">再来一套</button>
            </p>
          </div>
        </div>
      `;

      document.getElementById("again").addEventListener("click", () => {
        startExam();
      });

      if (wrongQuestions.length) {
        setTimeout(() => {
          startExam(wrongQuestions);
        }, 5000);
      }
    }

    // 页面加载就开始
    startExam();
  </script>
</body>
</html>
