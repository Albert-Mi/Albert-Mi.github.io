<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>科目三灯光考试模拟</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --panel: rgba(15, 23, 42, 0.75);
      --text: #e2e8f0;
      --green: #16a34a;
      --red: #f43f5e;
      --gray: #94a3b8;
      --brand: #3b82f6;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", sans-serif;
      background: radial-gradient(circle at 20% -20%, #1f2937, #020617 65%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 20px 10px 60px;
    }
    #app { width: min(900px, 100%); }
    .exam-box {
      background: var(--panel);
      border: 1px solid rgba(148, 163, 184, 0.12);
      border-radius: 20px;
      padding: 16px 16px 26px;
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 40px rgba(0,0,0,0.35);
    }
    .header { display: flex; justify-content: space-between; align-items: center; gap: 1rem; margin-bottom: 1rem; }
    .title { font-size: 1.1rem; margin: 0; }
    .timer { font-weight: 600; color: #f97316; }
    .question { font-size: 1.02rem; line-height: 1.6; margin-bottom: 1rem; white-space: pre-line; }
    .options { display: grid; grid-template-columns: 1fr; gap: 0.6rem; }
    .option-btn {
      background: rgba(15,23,42,0.1);
      border: 1px solid rgba(148,163,184,0.28);
      border-radius: 14px;
      padding: 0.65rem 0.9rem; text-align: left; font-size: 0.96rem;
      color: inherit; cursor: pointer; transition: 0.12s ease-out;
    }
    .option-btn:hover { background: rgba(148, 163, 184, 0.06); }
    .option-btn.disabled { pointer-events: none; opacity: 0.7; }
    .option-btn.correct { background: rgba(22, 163, 74, 0.18); border-color: rgba(22, 163, 74, 0.65); }
    .option-btn.wrong { background: rgba(244, 63, 94, 0.18); border-color: rgba(244, 63, 94, 0.6); }
    .result { margin-top: 1rem; min-height: 1.3rem; font-weight: 600; }
    .result.ok { color: var(--green); }
    .result.bad { color: var(--red); }
    .footer-tip { margin-top: 1.1rem; font-size: 0.8rem; color: var(--gray); }
    .score-panel { text-align: center; padding: 2.5rem 1rem 2rem; }
    .score-big { font-size: 3.4rem; font-weight: 800; margin-bottom: 1rem; }
    .btn { background: var(--brand); border: none; border-radius: 9999px; color: #fff; padding: 0.5rem 1.2rem; cursor: pointer; font-weight: 500; }
    @media (max-width: 640px) {
      .exam-box { border-radius: 14px; }
      .header { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div id="app"></div>
  <script>
    const OPTIONS = ["远光灯", "近光灯", "远近光灯交替", "示廓灯+双闪"];

    const QUESTION_BANK = [
      { text: "夜间直行通过路口", answer_index: 1 },
      { text: "夜间同方向近距离跟车行驶", answer_index: 1 },
      { text: "夜间与机动车会车", answer_index: 1 },
      { text: "夜间在有路灯的道路上行驶", answer_index: 1 },
      { text: "夜间在照明良好的道路上行驶", answer_index: 1 },
      { text: "夜间在照明不良条件下行驶", answer_index: 0 },
      { text: "夜间在没有路灯条件下行驶", answer_index: 0 },
      { text: "夜间通过急弯", answer_index: 2 },
      { text: "夜间通过坡路", answer_index: 2 },
      { text: "夜间通过拱桥", answer_index: 2 },
      { text: "夜间通过人行横道", answer_index: 2 },
      { text: "夜间超越前方车辆", answer_index: 2 },
      { text: "夜间通过没有交通信号灯控制的路口", answer_index: 2 },
      { text: "路边临时停车", answer_index: 3 },
      { text: "夜间在道路上发生故障", answer_index: 3 },
    ];

    function shuffle(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    let currentQuestions = [];
    let currentIndex = -1;
    let score = 0;
    let wrongQuestions = [];
    let timeLeft = 5;          // ← 每题 5 秒
    let tHandle = null;
    let running = false;

    function renderShell(title = "科目三灯光考试模拟（图片版）") {
      const app = document.getElementById("app");
      app.innerHTML = `
        <div class="exam-box">
          <div class="header">
            <h1 class="title" id="title">${title}</h1>
            <div class="timer" id="timer">剩余时间：${timeLeft} 秒</div>
          </div>
          <div class="question" id="question">正在载入题目...</div>
          <div class="options" id="options"></div>
          <div class="result" id="result"></div>
          <div class="footer-tip">
            规则：随机抽取 <strong>5</strong> 题，每题 <strong>5</strong> 秒；答错计错题，结束后显示成绩；若有错题，5 秒后自动进入“错题再考”。
          </div>
        </div>
      `;
    }

    function startExam(fromWrong = null) {
      if (fromWrong && fromWrong.length) {
        currentQuestions = fromWrong.length > 5 ? shuffle(fromWrong).slice(0, 5) : fromWrong.slice();
        renderShell("科目三灯光考试模拟（错题再考）");
      } else {
        currentQuestions = shuffle(QUESTION_BANK).slice(0, 5); // ← 随机 5 题
        renderShell();
      }
      currentIndex = -1;
      score = 0;
      wrongQuestions = [];
      running = true;
      nextQuestion();
    }

    function nextQuestion() {
      if (tHandle) clearTimeout(tHandle);
      currentIndex++;
      if (currentIndex >= currentQuestions.length) return finishExam();

      const q = currentQuestions[currentIndex];
      document.getElementById("question").textContent =
        `第 ${currentIndex + 1} 题 / 共 ${currentQuestions.length} 题\n${q.text}`;
      document.getElementById("result").textContent = "";
      const optEl = document.getElementById("options");
      optEl.innerHTML = "";
      OPTIONS.forEach((txt, i) => {
        const btn = document.createElement("button");
        btn.className = "option-btn";
        btn.textContent = `${i + 1}. ${txt}`;
        btn.onclick = () => choose(i);
        optEl.appendChild(btn);
      });
      timeLeft = 5; // ← 每题倒计时 5 秒
      running = true;
      tick();
    }

    function tick() {
      const el = document.getElementById("timer");
      el.textContent = `剩余时间：${timeLeft} 秒`;
      if (timeLeft <= 0) return timeout();
      timeLeft--;
      tHandle = setTimeout(tick, 1000);
    }

    function disableAll(markCorrect = null, markWrong = null) {
      const btns = document.querySelectorAll(".option-btn");
      btns.forEach(b => b.classList.add("disabled"));
      if (markCorrect !== null) btns[markCorrect].classList.add("correct");
      if (markWrong !== null) btns[markWrong].classList.add("wrong");
    }

    function choose(i) {
      if (!running) return;
      running = false;
      if (tHandle) clearTimeout(tHandle);

      const q = currentQuestions[currentIndex];
      const ok = i === q.answer_index;
      const res = document.getElementById("result");

      if (ok) {
        score++;
        res.textContent = "✅ 正确";
        res.className = "result ok";
        disableAll(q.answer_index, null);
      } else {
        res.textContent = "❌ 错误";
        res.className = "result bad";
        wrongQuestions.push(q);
        disableAll(q.answer_index, i);
      }
      setTimeout(nextQuestion, 1100);
    }

    function timeout() {
      if (!running) return;
      running = false;
      const q = currentQuestions[currentIndex];
      document.getElementById("result").textContent = "⌛ 超时，按错误处理";
      document.getElementById("result").className = "result bad";
      wrongQuestions.push(q);
      disableAll(q.answer_index, null);
      setTimeout(nextQuestion, 1100);
    }

    function finishExam() {
      if (tHandle) clearTimeout(tHandle);
      running = false;

      const app = document.getElementById("app");
      const total = currentQuestions.length;
      app.innerHTML = `
        <div class="exam-box">
          <div class="score-panel">
            <div class="score-big">${score} / ${total}</div>
            <p>本轮考试结束！</p>
            ${
              wrongQuestions.length
                ? `<p>共有 <strong>${wrongQuestions.length}</strong> 道错题，<strong>5 秒后</strong>自动开始“错题再考”。</p>`
                : `<p>全部答对，干得漂亮！</p>`
            }
            <p style="margin-top:1.3rem;">
              <button class="btn" id="again">再来一套</button>
            </p>
          </div>
        </div>
      `;
      document.getElementById("again").onclick = () => startExam();

      if (wrongQuestions.length) {
        const retry = wrongQuestions.slice();
        setTimeout(() => {
          if (retry.length) startExam(retry);
          else startExam();
        }, 5000); // ← 错题 5 秒后再考
      }
    }

    startExam();
  </script>
</body>
</html>
