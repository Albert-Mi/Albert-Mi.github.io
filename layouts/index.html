{{ define "main" }}
<!-- å…³é”®ï¼šç«‹å³éšè—é¡µé¢å†…å®¹ï¼Œé¿å…é—ªçƒ -->
<style id="cover-preload-style">
  /* åœ¨ cover åŠ è½½å‰éšè—æ‰€æœ‰å†…å®¹ */
  body {
    overflow: hidden !important;
  }
  
  .main-container,
  .article-list,
  nav,
  aside {
    opacity: 0 !important;
    visibility: hidden !important;
  }
</style>

<!-- Cover ç•Œé¢æ ·å¼ -->
<style>
:root{
  /* é¢œè‰²é…ç½® - åœ¨è¿™é‡Œè‡ªå®šä¹‰ */
  --cover-color-1: #2b6fff;      /* è“è‰² */
  --cover-color-2: #11cfe0;      /* é’è‰² */
  --cover-bg-light: #ffffff;     /* äº®è‰²èƒŒæ™¯ */
  --cover-bg-dark: #0a0c10;      /* æš—è‰²èƒŒæ™¯ */
  --cover-text-light: #111111;   /* äº®è‰²æ–‡å­— */
  --cover-text-dark: #ffffff;    /* æš—è‰²æ–‡å­— */
}

/* äº®è‰²æ¨¡å¼ */
#site-cover{
  --cover-text: var(--cover-text-light);
  --cover-bg: var(--cover-bg-light);
}

/* æš—è‰²æ¨¡å¼ */
html[data-theme="dark"] #site-cover{
  --cover-text: var(--cover-text-dark);
  --cover-bg: var(--cover-bg-dark);
}

/* è¦†ç›–å±‚ - å®Œå…¨ä¸é€æ˜ */
#site-cover{
  position: fixed;
  inset: 0;
  z-index: 99999;
  display: grid;
  place-items: center;
  overflow: hidden;
  background: var(--cover-bg);
  animation: cover-enter 400ms ease-out both;
}

@keyframes cover-enter{
  from{ opacity: 0; transform: scale(1.01); }
  to{ opacity: 1; transform: scale(1); }
}

/* èƒŒæ™¯å±‚ */
#site-cover .cover-bg{
  position: absolute;
  inset: 0;
  pointer-events: none;
  overflow: hidden;
}

/* æ¸å˜èƒŒæ™¯ - ç§»åŠ¨ç«¯ä¼˜åŒ–ç‰ˆæœ¬ */
#site-cover .bg-gradient{
  position: absolute;
  inset: 0;
  background: 
    radial-gradient(circle at 10% 20%, var(--cover-color-1) 0%, transparent 50%),
    radial-gradient(circle at 80% 30%, var(--cover-color-2) 0%, transparent 50%),
    radial-gradient(circle at 50% 80%, rgba(255,255,255,0.1) 0%, transparent 40%);
  opacity: 0.35;
  animation: floaty 14s ease-in-out infinite alternate;
  /* ç§»åŠ¨ç«¯æ€§èƒ½ä¼˜åŒ– */
  will-change: transform;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
}

/* æš—è‰²æ¨¡å¼çš„æ¸å˜ */
html[data-theme="dark"] #site-cover .bg-gradient{
  opacity: 0.45;
  background: 
    radial-gradient(circle at 10% 20%, var(--cover-color-1) 0%, transparent 50%),
    radial-gradient(circle at 80% 30%, var(--cover-color-2) 0%, transparent 50%),
    radial-gradient(circle at 50% 80%, rgba(255,255,255,0.05) 0%, transparent 40%);
}

/* ç§»åŠ¨ç«¯é¢å¤–å¢å¼ºæ˜¾ç¤º */
@media (max-width: 768px) {
  #site-cover .bg-gradient{
    opacity: 0.5;
    /* ç§»åŠ¨ç«¯ä½¿ç”¨æ›´ç®€å•çš„æ¸å˜ */
    background: 
      linear-gradient(135deg, var(--cover-color-1) 0%, transparent 60%),
      linear-gradient(225deg, var(--cover-color-2) 0%, transparent 60%);
  }
  
  html[data-theme="dark"] #site-cover .bg-gradient{
    opacity: 0.6;
  }
}

@keyframes floaty{
  0%{ transform: translate3d(-2%, -1%, 0) scale(1.02); }
  100%{ transform: translate3d(2%, 1%, 0) scale(1.04); }
}

/* æ–‡æ¡ˆå®¹å™¨ */
#site-cover .cover-content{
  position: relative;
  z-index: 2;
  max-width: min(90vw, 1200px);
  padding: 0 4vw;
  text-align: center;
  display: grid;
  place-items: center;
}

#site-cover .cover-lines{
  display: grid;
  gap: clamp(8px, 1.6vw, 18px);
}

#site-cover .line{
  color: var(--cover-text);
  font-weight: 700;
  letter-spacing: 0.2px;
  font-size: clamp(22px, 3.6vw, 48px);
  line-height: 1.15;
  opacity: 0;
  transform: translateY(8px);
  animation: line-in 800ms cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
  animation-delay: calc(var(--i) * 220ms + 250ms);
  text-shadow: 0 1px 0 rgba(0, 0, 0, 0.1);
}

@keyframes line-in{
  to { opacity: 1; transform: translateY(0); }
}

#site-cover .hint{
  margin-top: clamp(10px, 2vw, 18px);
  font-size: clamp(12px, 1.4vw, 14px);
  color: var(--cover-text);
  opacity: 0.75;
}

/* ç‚¹å‡»åæ·¡å‡º */
#site-cover.hide{
  pointer-events: none;
  animation: cover-exit 500ms ease-in forwards;
}

@keyframes cover-exit{
  to{ opacity: 0; transform: scale(1.01); }
}

/* æ˜¾ç¤ºä¸»å†…å®¹çš„åŠ¨ç”» */
.show-main-content .main-container,
.show-main-content .article-list,
.show-main-content nav,
.show-main-content aside {
  animation: main-content-enter 400ms ease-out forwards;
}

@keyframes main-content-enter{
  from { opacity: 0; }
  to { opacity: 1; }
}
</style>

<!-- Cover è„šæœ¬ - ä¸ä½¿ç”¨ deferï¼Œç«‹å³æ‰§è¡Œ -->
<script>
(function(){
  // æ£€æŸ¥æ˜¯å¦åœ¨æœ¬æ¬¡ä¼šè¯ä¸­å·²ç»æ˜¾ç¤ºè¿‡ cover
  var coverShown = sessionStorage.getItem('coverShown');
  
  if (coverShown === 'true') {
    console.log('ğŸ¯ Cover already shown, showing main content immediately');
    // ç«‹å³ç§»é™¤éšè—æ ·å¼
    var preloadStyle = document.getElementById('cover-preload-style');
    if (preloadStyle) {
      preloadStyle.remove();
    }
    document.body.classList.add('show-main-content');
    return;
  }
  
  function init() {
    console.log('ğŸ¯ Cover script started');
    
    {{ $lines := .Site.Params.cover.lines | default (slice "ä½ å¥½ï¼Œæˆ‘æ˜¯ Albert Mi" "æ¬¢è¿æ¥åˆ°æˆ‘çš„ä¸ªäººç½‘ç«™" "Science Â· Life Â· Peace") }}
    var lines = {{ $lines | jsonify }};
    
    // åˆ›å»º cover å…ƒç´ 
    var wrap = document.createElement('div');
    wrap.id = 'site-cover';
    wrap.innerHTML = [
      '<div class="cover-bg">',
      '  <div class="bg-gradient"></div>',
      '</div>',
      '<div class="cover-content">',
      '  <div class="cover-lines">',
      {{ range $i, $line := $lines }}
        '<div class="line" style="--i:{{ add $i 1 }};">{{ $line }}</div>',
      {{ end }}
      '    <div class="hint">( å•å‡»è¿›å…¥ / Tap to enter )</div>',
      '  </div>',
      '</div>'
    ].join('');
    
    // æ’å…¥åˆ° body æœ€å‰é¢
    if (document.body.firstChild) {
      document.body.insertBefore(wrap, document.body.firstChild);
    } else {
      document.body.appendChild(wrap);
    }
    
    console.log('âœ… Cover added to page');
    
    // éšè—ä¸»å†…å®¹çš„å‡½æ•°
    function hide(){
      console.log('ğŸ¯ Hiding cover');
      wrap.classList.add('hide');
      
      setTimeout(function(){
        try { 
          document.body.removeChild(wrap);
          console.log('âœ… Cover removed');
        } catch(e){
          console.error('Error removing cover:', e);
        }
        
        // ç§»é™¤é¢„åŠ è½½æ ·å¼
        var preloadStyle = document.getElementById('cover-preload-style');
        if (preloadStyle) {
          preloadStyle.remove();
        }
        
        // æ˜¾ç¤ºä¸»å†…å®¹
        document.body.classList.add('show-main-content');
        
        // æ¢å¤æ»šåŠ¨
        document.documentElement.style.overflow = '';
        document.body.style.overflow = '';
        
        // æ ‡è®°å·²æ˜¾ç¤º
        sessionStorage.setItem('coverShown', 'true');
        console.log('âœ… Main content shown');
      }, 600);
    }
    
    // ç‚¹å‡»äº‹ä»¶
    function onInteract(e){ 
      console.log('ğŸ¯ User interacted with cover');
      if (e.preventDefault) e.preventDefault();
      hide(); 
    }
    
    // æ·»åŠ äº‹ä»¶ç›‘å¬
    wrap.addEventListener('click', onInteract);
    wrap.addEventListener('touchstart', onInteract, { passive: true });
    
    console.log('âœ… Cover initialized');
  }
  
  // ç«‹å³æ‰§è¡Œï¼ˆä¸ç­‰å¾… DOMContentLoadedï¼‰
  if (document.body) {
    init();
  } else {
    // å¦‚æœ body è¿˜æ²¡æœ‰ï¼Œç­‰å¾…å®ƒ
    document.addEventListener('DOMContentLoaded', init);
  }
})();
</script>

<!-- åŸæœ‰çš„é¦–é¡µå†…å®¹ -->
<section class="article-list">
    {{- $pages := where .Site.RegularPages "Type" "in" .Site.Params.mainSections -}}
    {{- $notHidden := where $pages "Params.hidden" "!=" true -}}
    {{- $filtered := (where $notHidden "PublishDate" "<=" now) -}}
    {{- $pag := .Paginate ($filtered) -}}

    {{ range $index, $element := $pag.Pages }}
        {{ partial "article-list/default" . }}
    {{ end }}

    {{- partial "pagination.html" . -}}
</section>

{{ end }}

{{- define "left-sidebar" -}}
    {{ partial "sidebar/left.html" . }}
{{- end -}}

{{- define "right-sidebar" -}}
    {{ partial "sidebar/right.html" (dict "Context" . "Scope" "homepage") }}
{{- end -}}
