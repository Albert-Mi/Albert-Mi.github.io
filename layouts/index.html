{{ define "main" }}
<!-- Cover ç•Œé¢ - æ”¹è¿›ç‰ˆ -->
<style>
:root{
  /* ä½ å¯ä»¥åœ¨è¿™é‡Œè‡ªå®šä¹‰é¢œè‰² */
  --cover-color-1: #2b6fff;      /* è“è‰² - å¯æ”¹ä¸ºä»»ä½•é¢œè‰²ï¼Œå¦‚ #FF0000 */
  --cover-color-2: #11cfe0;      /* é’è‰² - å¯æ”¹ä¸ºä»»ä½•é¢œè‰²ï¼Œå¦‚ #00FF00 */
  --cover-bg-light: #ffffff;     /* äº®è‰²æ¨¡å¼èƒŒæ™¯ */
  --cover-bg-dark: #0a0c10;      /* æš—è‰²æ¨¡å¼èƒŒæ™¯ */
  --cover-text-light: #111111;   /* äº®è‰²æ¨¡å¼æ–‡å­— */
  --cover-text-dark: #ffffff;    /* æš—è‰²æ¨¡å¼æ–‡å­— */
}

/* äº®è‰²æ¨¡å¼ */
#site-cover{
  --cover-text: var(--cover-text-light);
  --cover-bg: var(--cover-bg-light);
}

/* æš—è‰²æ¨¡å¼ */
html[data-theme="dark"] #site-cover,
@media (prefers-color-scheme: dark){
  #site-cover{
    --cover-text: var(--cover-text-dark);
    --cover-bg: var(--cover-bg-dark);
  }
}

/* è¦†ç›–å±‚ - å®Œå…¨ä¸é€æ˜ */
#site-cover{
  position: fixed;
  inset: 0;
  z-index: 99999;  /* è¶…é«˜ä¼˜å…ˆçº§ï¼Œç¡®ä¿åœ¨æœ€ä¸Šå±‚ */
  display: grid;
  place-items: center;
  overflow: hidden;
  background: var(--cover-bg);  /* å®Œå…¨ä¸é€æ˜çš„èƒŒæ™¯ */
  animation: cover-enter 400ms ease-out both;
}

@keyframes cover-enter{
  from{ opacity: 0; transform: scale(1.01); }
  to{ opacity: 1; transform: scale(1); }
}

/* èƒŒæ™¯å±‚ */
#site-cover .cover-bg{
  position: absolute;
  inset: 0;
  pointer-events: none;
}

/* æ¸å˜èƒŒæ™¯ - å»æ‰çº¿æ¡ */
#site-cover .bg-gradient{
  position: absolute;
  inset: 0;
  filter: blur(30px);
  background:
    radial-gradient(1200px 1200px at 10% 20%, var(--cover-color-1), transparent 60%),
    radial-gradient(900px 900px at 80% 30%, var(--cover-color-2), transparent 60%),
    linear-gradient(135deg, var(--cover-bg), var(--cover-bg));
  opacity: 0.3;  /* é™ä½æ¸å˜ä¸é€æ˜åº¦ */
  animation: floaty 14s ease-in-out infinite alternate;
}

html[data-theme="dark"] #site-cover .bg-gradient{
  opacity: 0.4;
}

@keyframes floaty{
  0%{ transform: translate3d(-2%, -1%, 0) scale(1.02); }
  100%{ transform: translate3d(2%, 1%, 0) scale(1.04); }
}

/* æ–‡æ¡ˆå®¹å™¨ */
#site-cover .cover-content{
  position: relative;
  z-index: 2;
  max-width: min(90vw, 1200px);
  padding: 0 4vw;
  text-align: center;
  display: grid;
  place-items: center;
}

#site-cover .cover-lines{
  display: grid;
  gap: clamp(8px, 1.6vw, 18px);
}

#site-cover .line{
  color: var(--cover-text);
  font-weight: 700;
  letter-spacing: 0.2px;
  font-size: clamp(22px, 3.6vw, 48px);
  line-height: 1.15;
  opacity: 0;
  transform: translateY(8px);
  animation: line-in 800ms cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
  animation-delay: calc(var(--i) * 220ms + 250ms);
  text-shadow: 0 1px 0 rgba(0, 0, 0, 0.1);
}

@keyframes line-in{
  to { opacity: 1; transform: translateY(0); }
}

#site-cover .hint{
  margin-top: clamp(10px, 2vw, 18px);
  font-size: clamp(12px, 1.4vw, 14px);
  color: var(--cover-text);
  opacity: 0.75;
}

/* ç‚¹å‡»åæ·¡å‡º */
#site-cover.hide{
  pointer-events: none;
  animation: cover-exit 500ms ease-in forwards;
}

@keyframes cover-exit{
  to{ opacity: 0; transform: scale(1.01); }
}
</style>

<script>
(function(){
  // æ£€æŸ¥ sessionStorageï¼Œå¦‚æœå·²ç»æ˜¾ç¤ºè¿‡ï¼Œå°±ä¸å†æ˜¾ç¤º
  var coverShown = sessionStorage.getItem('coverShown');
  
  if (coverShown === 'true') {
    console.log('ğŸ¯ Cover already shown in this session, skipping');
    return;
  }
  
  function init() {
    console.log('ğŸ¯ Inline cover script started');
    
    {{ $lines := .Site.Params.cover.lines | default (slice "ä½ å¥½ï¼Œæˆ‘æ˜¯ Albert Mi" "æ¬¢è¿æ¥åˆ°æˆ‘çš„ä¸ªäººç½‘ç«™" "Science Â· Life Â· Peace") }}
    var lines = {{ $lines | jsonify }};
    
    var wrap = document.createElement('div');
    wrap.id = 'site-cover';
    wrap.innerHTML = [
      '<div class="cover-bg">',
      '  <div class="bg-gradient"></div>',
      '</div>',
      '<div class="cover-content">',
      '  <div class="cover-lines">',
      {{ range $i, $line := $lines }}
        '<div class="line" style="--i:{{ add $i 1 }};">{{ $line }}</div>',
      {{ end }}
      '    <div class="hint">( å•å‡»è¿›å…¥ / Tap to enter )</div>',
      '  </div>',
      '</div>'
    ].join('');
    
    var html = document.documentElement;
    var prevOverflow = html.style.overflow;
    html.style.overflow = 'hidden';
    
    document.body.appendChild(wrap);
    console.log('âœ… Cover added to page');
    
    function hide(){
      wrap.classList.add('hide');
      setTimeout(function(){
        try { 
          document.body.removeChild(wrap);
          console.log('âœ… Cover removed');
        } catch(e){}
        html.style.overflow = prevOverflow || '';
        // æ ‡è®° cover å·²æ˜¾ç¤º
        sessionStorage.setItem('coverShown', 'true');
      }, 700);
    }
    
    function onInteract(e){ 
      e.preventDefault && e.preventDefault(); 
      hide(); 
    }
    
    wrap.addEventListener('click', onInteract, { passive: false });
    wrap.addEventListener('touchstart', onInteract, { passive: false });
  }
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>

<!-- åŸæœ‰çš„é¦–é¡µå†…å®¹ - è¿™éƒ¨åˆ†æ¥è‡ªä¸»é¢˜ -->
<section class="article-list">
    {{- $pages := where .Site.RegularPages "Type" "in" .Site.Params.mainSections -}}
    {{- $notHidden := where $pages "Params.hidden" "!=" true -}}
    {{- $filtered := (where $notHidden "PublishDate" "<=" now) -}}
    {{- $pag := .Paginate ($filtered) -}}

    {{ range $index, $element := $pag.Pages }}
        {{ partial "article-list/default" . }}
    {{ end }}

    {{- partial "pagination.html" . -}}
</section>

{{ end }}

{{- define "left-sidebar" -}}
    {{ partial "sidebar/left.html" . }}
{{- end -}}

{{- define "right-sidebar" -}}
    {{ partial "sidebar/right.html" (dict "Context" . "Scope" "homepage") }}
{{- end -}}
