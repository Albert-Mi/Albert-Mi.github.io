{{ define "main" }}

{{/* 收集当前页面包中的所有图片 */}}
{{ $all := .Resources.ByType "image" }}
{{ $images := slice }}
{{ range $all }}
  {{ $images = $images | append (dict "src" .RelPermalink "title" .Name) }}
{{ end }}

<article class="prose max-w-none">
  <header>
    <h1>{{ .Title }}</h1>
    {{ with .Params.tags }}
      <p>{{ range . }}<span class="badge">#{{ . }}</span> {{ end }}</p>
    {{ end }}
    {{ with .Content }}
      <div class="mt-4 mb-6">{{ . }}</div>
    {{ end }}
  </header>

  <!-- 画廊根节点：只保留「每页 / 每行」两个参数 -->
  <div
    id="gallery-root"
    class="gallery-root"
    data-images='{{ $images | jsonify }}'
    data-per-page='{{ with .Params.galleryPerPage }}{{ . }}{{ else }}{{ with site.Params.gallery.perPage }}{{ . }}{{ else }}20{{ end }}{{ end }}'
    data-per-row='{{ with .Params.galleryPerRow }}{{ . }}{{ else }}{{ with site.Params.gallery.perRow }}{{ . }}{{ else }}4{{ end }}{{ end }}'
  ></div>
</article>

{{ end }}
